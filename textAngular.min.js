if(!window.console)console={log:function(){}};var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",["$compile","$window","$document","$rootScope","$timeout",function($compile,$window,$document,$rootScope,$timeout){console.log("Thank you for using textAngular! http://www.textangular.com");function deepExtend(destination,source){for(var property in source){if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};arguments.callee(destination[property],source[property])}else{destination[property]=source[property]}}return destination}$rootScope.textAngularOpts=deepExtend({toolbar:[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"}},$rootScope.textAngularOpts!=null?$rootScope.textAngularOpts:{});var queryFormatBlockState=function(command){command=command.toLowerCase();var val=$document[0].queryCommandValue("formatBlock").toLowerCase();return val===command||val===command};$rootScope.textAngularTools=deepExtend({html:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var ht,_this=this;this.$parent.showHtml=!this.$parent.showHtml;if(this.$parent.showHtml){$timeout(function(){return _this.$parent.displayElements.html[0].focus()},100)}else{$timeout(function(){return _this.$parent.displayElements.text[0].focus()},100)}this.active=this.$parent.showHtml}},h1:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")},activeState:function(){return queryFormatBlockState("h1")}},h2:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")},activeState:function(){return queryFormatBlockState("h2")}},h3:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")},activeState:function(){return queryFormatBlockState("h3")}},p:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return queryFormatBlockState("p")}},pre:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return queryFormatBlockState("pre")}},ul:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ul'></i></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return $document[0].queryCommandState("insertUnorderedList")}},ol:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ol'></i></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return $document[0].queryCommandState("insertOrderedList")}},quote:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-quote-right'></i></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return queryFormatBlockState("blockquote")}},undo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-undo'></i></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-repeat'></i></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-bold'></i></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return $document[0].queryCommandState("bold")}},justifyLeft:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-left'></i></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return $document[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-right'></i></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return $document[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-center'></i></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return $document[0].queryCommandState("justifyCenter")}},italics:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-italic'></i></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return $document[0].queryCommandState("italic")}},underline:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-underline'></i></button>",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return $document[0].queryCommandState("underline")}},clear:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-ban'></i></button>",action:function(){return this.$parent.wrapSelection("removeFormat",null)}},insertImage:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-picture-o'></i></button>",action:function(){var imageLink;imageLink=prompt("Please enter an image URL to insert","http://");if(imageLink!==""){return this.$parent.wrapSelection("insertImage",imageLink)}}},insertLink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-link'></i></button>",action:function(){var urlLink;urlLink=prompt("Please enter an URL to insert","http://");if(urlLink!==""){return this.$parent.wrapSelection("createLink",urlLink)}}},unlink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-unlink'></i></button>",action:function(){return this.$parent.wrapSelection("unlink",null)}}},$rootScope.textAngularTools!=null?$rootScope.textAngularTools:{});return{require:"?ngModel",scope:{},restrict:"EA",link:function(scope,element,attrs,ngModel){var group,groupElement,keydown,keyup,mouseup,tool,toolElement;angular.extend(scope,$rootScope.textAngularOpts,{wrapSelection:function(command,opt){document.execCommand(command,false,opt);if(scope.showHtml)scope.displayElements.html[0].focus();else scope.displayElements.text[0].focus();scope.updateSelectedStyles();if(!scope.showHtml)scope.updateTaBindtext()},showHtml:false});if(!!attrs.taToolbar)scope.toolbar=scope.$eval(attrs.taToolbar);if(!!attrs.taFocussedClass)scope.classes.focussed=scope.$eval(attrs.taFocussedClass);if(!!attrs.taToolbarClass)scope.classes.toolbar=attrs.taToolbarClass;if(!!attrs.taToolbarGroupClass)scope.classes.toolbarGroup=attrs.taToolbarGroupClass;if(!!attrs.taToolbarButtonClass)scope.classes.toolbarButton=attrs.taToolbarButtonClass;if(!!attrs.taToolbarActiveButtonClass)scope.classes.toolbarButtonActive=attrs.taToolbarActiveButtonClass;if(!!attrs.taTextEditorClass)scope.classes.textEditor=attrs.taTextEditorClass;if(!!attrs.taHtmlEditorClass)scope.classes.htmlEditor=attrs.taHtmlEditorClass;var originalContents=element.html();element.html("");scope.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")};element.append(scope.displayElements.toolbar);element.append(scope.displayElements.text);element.append(scope.displayElements.html);if(!!attrs.name){scope.displayElements.forminput.attr("name",attrs.name);element.append(scope.displayElements.forminput)}if(!!attrs.taDisabled){scope.displayElements.text.attr("ta-readonly","disabled");scope.displayElements.html.attr("ta-readonly","disabled");scope.disabled=scope.$parent.$eval(attrs.taDisabled);scope.$parent.$watch(attrs.taDisabled,function(newVal){scope.disabled=newVal;if(scope.disabled){element.addClass("disabled")}else{element.removeClass("disabled")}})}$compile(scope.displayElements.text)(scope);$compile(scope.displayElements.html)(scope);element.addClass("ta-root");scope.displayElements.toolbar.addClass("ta-toolbar "+scope.classes.toolbar);scope.displayElements.text.addClass("ta-text ta-editor "+scope.classes.textEditor);scope.displayElements.html.addClass("ta-html ta-editor "+scope.classes.textEditor);element.on("focusin",function(){element.addClass(scope.classes.focussed);$timeout(function(){if(scope.showHtml)scope.displayElements.html[0].focus();else scope.displayElements.text[0].focus()},0)});element.on("focusout",function(){$timeout(function(){if(!($document[0].activeElement===scope.displayElements.html[0])&&!($document[0].activeElement===scope.displayElements.text[0])){element.removeClass(scope.classes.focussed);$timeout(function(){element.triggerHandler("blur")},0)}},0)});scope.tools={};for(var _i=0;_i<scope.toolbar.length;_i++){group=scope.toolbar[_i];groupElement=angular.element("<div></div>");groupElement.addClass(scope.classes.toolbarGroup);for(var _j=0;_j<group.length;_j++){tool=group[_j];toolElement=angular.element($rootScope.textAngularTools[tool].display);toolElement.addClass(scope.classes.toolbarButton);toolElement.attr("unselectable","on");toolElement.attr("tabindex","-1");toolElement.attr("ng-disabled","showHtml()");var childScope=angular.extend(scope.$new(true),$rootScope.textAngularTools[tool],{name:tool,showHtml:function(){if(this.name!=="html")return this.$parent.disabled||this.$parent.showHtml;return this.$parent.disabled},displayActiveToolClass:function(active){return active?this.$parent.classes.toolbarButtonActive:""}});scope.tools[tool]=childScope;groupElement.append($compile(toolElement)(childScope))}scope.displayElements.toolbar.append(groupElement)}if(attrs.ngModel){ngModel.$render=function(){scope.displayElements.forminput.val(ngModel.$viewValue);if(!($document[0].activeElement===scope.displayElements.html[0])&&!($document[0].activeElement===scope.displayElements.text[0])){var val=ngModel.$viewValue||"";scope.text=val;scope.html=val}}}else{scope.displayElements.forminput.val(originalContents);scope.text=originalContents;scope.html=originalContents}scope.$watch("text",function(newValue,oldValue){scope.html=newValue;if(attrs.ngModel&&newValue!==oldValue)ngModel.$setViewValue(newValue);scope.displayElements.forminput.val(newValue)});scope.$watch("html",function(newValue,oldValue){scope.text=newValue;if(attrs.ngModel&&newValue!==oldValue)ngModel.$setViewValue(newValue);scope.displayElements.forminput.val(newValue)});scope.bUpdateSelectedStyles=false;scope.updateSelectedStyles=function(){for(var _k=0;_k<scope.toolbar.length;_k++){var groups=scope.toolbar[_k];for(var _l=0;_l<groups.length;_l++){tool=groups[_l];if(scope.tools[tool].activeState!=null){scope.tools[tool].active=scope.tools[tool].activeState.apply(scope)}}}if(scope.bUpdateSelectedStyles)$timeout(scope.updateSelectedStyles,200)};keydown=function(e){if(!scope.bUpdateSelectedStyles){scope.bUpdateSelectedStyles=true;scope.$apply(function(){scope.updateSelectedStyles()})}};scope.displayElements.html.on("keydown",keydown);scope.displayElements.text.on("keydown",keydown);keyup=function(e){scope.bUpdateSelectedStyles=false};scope.displayElements.html.on("keyup",keyup);scope.displayElements.text.on("keyup",keyup);mouseup=function(e){scope.$apply(function(){scope.updateSelectedStyles()})};scope.displayElements.html.on("mouseup",mouseup);scope.displayElements.text.on("mouseup",mouseup)}}}]).directive("taBind",["$sanitize","$document","taFixChrome",function($sanitize,$document,taFixChrome){return{require:"ngModel",scope:{taBind:"@"},link:function(scope,element,attrs,ngModel){var isContentEditable=element[0].tagName.toLowerCase()!=="textarea"&&element[0].tagName.toLowerCase()!=="input"&&element.attr("contenteditable")!==undefined&&element.attr("contenteditable");var isReadonly=false;var compileHtml=function(){var result=taFixChrome(element).html();if(scope.taBind==="html"&&isContentEditable)result=result.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return result};scope.$parent["updateTaBind"+scope.taBind]=function(){var compHtml=compileHtml();var tempParsers=ngModel.$parsers;ngModel.$parsers=[];ngModel.$oldViewValue=compHtml;ngModel.$setViewValue(compHtml);ngModel.$parsers=tempParsers};if(isContentEditable){element.on("keyup",function(e){if(!isReadonly)ngModel.$setViewValue(compileHtml())})}function trySanitize(unsafe,oldsafe){var safe;try{safe=$sanitize(unsafe)}catch(e){safe=oldsafe||""}return safe}ngModel.$parsers.push(function(unsafe){var safe=ngModel.$oldViewValue=trySanitize(unsafe,ngModel.$oldViewValue);return safe});ngModel.$formatters.push(function(unsafe){var safe=trySanitize(unsafe,"");return safe});ngModel.$render=function(){if($document[0].activeElement!==element[0]){var val=ngModel.$viewValue||"";ngModel.$oldViewValue=val;if(scope.taBind==="text"){try{angular.element(val).find("script").remove()}catch(e){}element.html(val);element.find("a").on("click",function(e){e.preventDefault();return false})}else if(isContentEditable||element[0].tagName.toLowerCase()!=="textarea"&&element[0].tagName.toLowerCase()!=="input")element.html(val.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));else element.val(val)}else if(!isContentEditable)element.val(val)};if(!!attrs.taReadonly){if(scope.$parent.$eval(attrs.taReadonly)){if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input")element.attr("disabled","disabled");if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable"))element.removeAttr("contenteditable")}else{if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input")element.removeAttr("disabled");else if(isContentEditable)element.attr("contenteditable","true")}scope.$parent.$watch(attrs.taReadonly,function(newVal,oldVal){if(oldVal===newVal)return;if(newVal){if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input")element.attr("disabled","disabled");if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable"))element.removeAttr("contenteditable")}else{if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input")element.removeAttr("disabled");else if(isContentEditable)element.attr("contenteditable","true")}isReadonly=newVal})}}}}]).factory("taFixChrome",function(){var taFixChrome=function($html){var spans=angular.element($html).find("span");for(var s=0;s<spans.length;s++){var span=angular.element(spans[s]);if(span.attr("style")&&span.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){if(span.next().length>0&&span.next()[0].tagName==="BR")span.next().remove();span.replaceWith(span.html())}}var result=$html.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");if(result!==$html.html())$html.html(result);return $html};return taFixChrome});