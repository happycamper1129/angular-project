<<<<<<< HEAD
var textAngular=angular.module("textAngular",[]);textAngular.directive("compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){element.html(value);$compile(element.contents())(scope)})}});textAngular.directive("textAngular",function($compile,$sce,$window,$timeout){var sanitizationWrapper=function(html){return $sce.trustAsHtml(html)};try{angular.isDefined(angular.module("ngSanitize"))}catch(e){sanitizationWrapper=function(html){return html}}var methods={theme:function(scope,opts){if(opts.disableStyle){return false}scope.theme=!!!opts.theme?{}:opts.theme;var editorDefault={resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left",padding:"4px"};var toolbarDefault={margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",display:"inline-block"};scope.theme.editor=!!!scope.theme.editor?{background:"#FFFFFF",color:"#5E5E5E",border:"1px solid #C4C4C4",padding:"4px",resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left","border-radius":"3px"}:angular.extend(scope.theme.editor,editorDefault);scope.theme.toolbar=!!!scope.theme.toolbar?{margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",border:"1px #C4C4C4",display:"inline-block"}:angular.extend(scope.theme.toolbar,toolbarDefault);scope.theme.toolbarItems=!!!scope.theme.toolbarItems?{cursor:"pointer",display:"inline-block",padding:"0.2em 0.4em","margin-left":"0em",background:"gray",color:"white","font-size":"14px"}:scope.theme.toolbarItems;scope.theme.insertForm=!!!scope.theme.insertForm?{"text-align":"right",padding:"0.2em"}:scope.theme.insertForm;scope.theme.insertFormBtn=!!!scope.theme.insertFormBtn?{"margin-top":"0.2em"}:scope.theme.insertFormBtn},compileHtml:function(scope,html){var compHtml=$("<div>").append(html).html().replace(/(class="(.*?)")|(class='(.*?)')/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/style=("|')(.*?)("|')/g,"");if(scope.showHtml=="load"){scope.textAngularModel.text=sanitizationWrapper(compHtml);scope.textAngularModel.html=sanitizationWrapper(compHtml.replace(/</g,"&lt;"));scope.showHtml=(scope.showHtmlDefault||false)}else{if(scope.showHtml){scope.textAngularModel.text=sanitizationWrapper(compHtml)}else{scope.textAngularModel.html=sanitizationWrapper(compHtml.replace(/</g,"&lt;"))}}scope.$parent.textAngularOpts.textAngularEditors[scope.name]["html"]=compHtml},wrapSelection:function(command,opt){document.execCommand(command,false,opt)},preCompileHtml:function(scope,el){if(scope.showHtml){var ht=$(el).find(".textAngular-html").html()}else{var ht=$(el).find(".textAngular-text").html()}methods.compileHtml(scope,ht)},toolbarFn:{html:function(scope,el){scope.showHtml=!scope.showHtml;if(scope.showHtml){var ht=$(el).find(".textAngular-text").html();$timeout(function(){$(el).find(".textAngular-html").focus()},100)}else{var ht=$(el).find(".textAngular-html").html();$timeout(function(){$(el).find(".textAngular-text").focus()},100)}methods.compileHtml(scope,ht)},h1:function(scope){methods.wrapSelection("formatBlock","<H1>")},h2:function(scope){methods.wrapSelection("formatBlock","<H2>")},h3:function(scope){methods.wrapSelection("formatBlock","<H3>")},p:function(scope){methods.wrapSelection("formatBlock","<P>")},pre:function(scope){methods.wrapSelection("formatBlock","<PRE>")},ul:function(scope){methods.wrapSelection("insertUnorderedList",null)},ol:function(scope){methods.wrapSelection("insertOrderedList",null)},quote:function(scope){methods.wrapSelection("formatBlock","<BLOCKQUOTE>")},undo:function(scope){methods.wrapSelection("undo",null)},redo:function(scope){methods.wrapSelection("redo",null)},b:function(scope){methods.wrapSelection("bold",null)},justifyLeft:function(scope){methods.wrapSelection("justifyLeft",null)},justifyRight:function(scope){methods.wrapSelection("justifyRight",null)},justifyCenter:function(scope){methods.wrapSelection("justifyCenter",null)},i:function(scope){methods.wrapSelection("italic",null)},clear:function(scope){methods.wrapSelection("FormatBlock","<div>")},insertImage:function(scope){if(scope.inserting==true){scope.inserting=false;return false}scope.insert.model="";scope.inserting=true;scope.insert.text="Insert Image";scope.currentInsert="insertImage"},insertHtml:function(scope){if(scope.inserting==true){scope.inserting=false;return false}scope.insert.model="";scope.inserting=true;scope.insert.text="Insert HTML";scope.currentInsert="insertHtml"},createLink:function(scope){if(scope.inserting==true){scope.inserting=false;return false}scope.insert.model="";scope.inserting=true;scope.insert.text="Make a Link";scope.currentInsert="createLink"}}};return{template:"<div class='textAngular-root' style='text-align:right;'><div class='textAngular-toolbar' ng-style='theme.toolbar'><span ng-repeat='toolbarItem in toolbar' title='{{toolbarItem.title}}' class='textAngular-toolbar-item' ng-style='theme.toolbarItems' ng-mousedown='runToolbar(toolbarItem.name,$event)' unselectable='on' compile='toolbarItem.icon' name='toolbarItem.name'></span></div><form class='textAngular-insert' ng-show='inserting' ng-style='theme.insertForm'><input type='text' ng-model='insert.model' required><div class='textAngular-insert-submit'><button ng-style='theme.insertFormBtn' ng-mousedown='finishInsert();'>{{insert.text}}</button></div></form><pre contentEditable='true' ng-show='showHtml' class='textAngular-html' ng-style='theme.editor' ng-bind-html='textAngularModel.html' ></pre><div contentEditable='true' ng-hide='showHtml' class='textAngular-text' ng-style='theme.editor' ng-bind-html='textAngularModel.text' ></div></div>",replace:true,scope:{},restrict:"A",controller:function($scope,$element,$attrs){console.log("Thank you for using textAngular! http://www.textangular.com");$scope.insert={};$scope.finishInsert=function(){methods.wrapSelection($scope.currentInsert,$scope.insert.model);methods.preCompileHtml($scope,$element);$scope.inserting=false};$scope.runToolbar=function(name,$event){$event.preventDefault();var wd=methods.toolbarFn[name]($scope,$element);if(name=="html"){return}methods.preCompileHtml($scope,$element)}},link:function(scope,el,attr){scope.$parent.$watch("textAngularOpts",function(){if(!!!scope.$parent.textAngularOpts){console.log("No textAngularOpts config object found in scope! Please create one!")}scope.showHtml="load";if(!!!attr.textAngularName){console.log("No 'text-angular-name' directive found on directve root element. Please add one! ");return false}var name=attr.textAngularName;scope.name=name;if(!!!scope.$parent.textAngularOpts.textAngularEditors){scope.$parent.textAngularOpts.textAngularEditors={}}if(!!!scope.$parent.textAngularOpts.textAngularEditors[name]){scope.$parent.textAngularOpts.textAngularEditors[name]={};var opts=scope.$parent.textAngularOpts;scope.toolbar=scope.$parent.textAngularOpts.toolbar}else{var opts=scope.$parent.textAngularOpts.textAngularEditors[name];scope.toolbar=scope.$parent.textAngularOpts.textAngularEditors[name].toolbar}scope.$parent.$watch('textAngularOpts.textAngularEditors["'+name+'"].html',function(oldVal,newVal){if(!!!$(":focus").parents(".textAngular-root")[0]){scope.textAngularModel.text=sanitizationWrapper(newVal);scope.textAngularModel.html=sanitizationWrapper(newVal.replace(/</g,"&lt;"))}},true);methods.theme(scope,opts);scope.textAngularModel={};methods.compileHtml(scope,opts.html);$(el).find(".textAngular-text,.textAngular-html").on("keyup",function(e){if(scope.showHtml){var ht=$(this.parentNode).find(".textAngular-html").html()}else{var ht=$(this.parentNode).find(".textAngular-text").html()}scope.$apply(methods.preCompileHtml(scope,this.parentNode))})})}}});
=======
var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",function($compile,$sce,$window,$document,$rootScope,$timeout){console.log("Thank you for using textAngular! http://www.textangular.com");$rootScope.textAngularOpts=angular.extend({toolbar:[["h1","h2","h3","p","pre","bold","italics","ul","ol","redo","undo","clear"],["html","insertImage","insertLink"]],classes:{toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"}},$rootScope.textAngularOpts!=null?$rootScope.textAngularOpts:{});$rootScope.textAngularTools=angular.extend({html:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var ht,_this=this;this.$parent.showHtml=!this.$parent.showHtml;if(this.$parent.showHtml){ht=this.$parent.displayElements.text.html();$timeout(function(){return _this.$parent.displayElements.html[0].focus()},100)}else{ht=this.$parent.displayElements.html.html();$timeout(function(){return _this.$parent.displayElements.text[0].focus()},100)}this.$parent.compileHtml(ht);this.active=this.$parent.showHtml}},h1:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")}},h2:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")}},h3:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")}},p:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")}},pre:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")}},ul:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ul'></i></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)}},ol:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ol'></i></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)}},quote:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-quote-right'></i></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")}},undo:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-undo'></i></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-repeat'></i></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-bold'></i></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return $document[0].queryCommandState("bold")}},justifyLeft:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-left'></i></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return $document[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-right'></i></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return $document[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-center'></i></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return $document[0].queryCommandState("justifyCenter")}},italics:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-italic'></i></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return $document[0].queryCommandState("italic")}},clear:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-ban'></i></button>",action:function(){return this.$parent.wrapSelection("FormatBlock","<div>")}},insertImage:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-picture-o'></i></button>",action:function(){var imageLink;imageLink=prompt("Please enter an image URL to insert","http://");if(imageLink!==""){return this.$parent.wrapSelection("insertImage",imageLink)}}},insertLink:{display:"<button ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-chain'></i></button>",action:function(){var urlLink;urlLink=prompt("Please enter an URL to insert","http://");if(urlLink!==""){return this.$parent.wrapSelection("createLink",urlLink)}}}},$rootScope.textAngularTools!=null?$rootScope.textAngularTools:{});var sanitizationWrapper=function(html){return $sce.trustAsHtml(html)};return{require:"ngModel",scope:{},restrict:"EA",link:function(scope,element,attrs,ngModel){var group,groupElement,keydown,keyup,tool,toolElement;angular.extend(scope,$rootScope.textAngularOpts,{compileHtml:function(html){var compHtml=angular.element("<div>").append(html).html().replace(/(class="(.*?)")|(class='(.*?)')/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/style=("|')(.*?)("|')/g,"");if(scope.showHtml==="load"){scope.text=sanitizationWrapper(compHtml);scope.html=sanitizationWrapper(compHtml.replace(/</g,"&lt;"));scope.showHtml=scope.showHtmlDefault||false}else if(scope.showHtml){scope.text=sanitizationWrapper(compHtml)}else{scope.html=sanitizationWrapper(compHtml.replace(/</g,"&lt;"))}ngModel.$setViewValue(compHtml)},wrapSelection:function(command,opt,updateDisplay){if(updateDisplay==null)updateDisplay=true;document.execCommand(command,false,opt);if(scope.showHtml)scope.displayElements.text[0].focus();else scope.displayElements.html[0].focus();if(updateDisplay)scope.updateDisplay()},updateDisplay:function(){scope.compileHtml(!scope.showHtml?scope.displayElements.html.html():scope.displayElements.text.html())},showHtml:false});if(!!attrs.taToolbar)scope.toolbar=scope.$eval(attrs.taToolbar);if(!!attrs.taToolbarClass)scope.classes.toolbar=attrs.taToolbarClass;if(!!attrs.taToolbarGroupClass)scope.classes.toolbarGroup=attrs.taToolbarGroupClass;if(!!attrs.taToolbarButtonClass)scope.classes.toolbarButton=attrs.taToolbarButtonClass;if(!!attrs.taToolbarActiveButtonClass)scope.classes.toolbarButtonActive=attrs.taToolbarActiveButtonClass;if(!!attrs.taTextEditorClass)scope.classes.textEditor=attrs.taTextEditorClass;if(!!attrs.taHtmlEditorClass)scope.classes.htmlEditor=attrs.taHtmlEditorClass;scope.displayElements={toolbar:angular.element("<div></div>"),text:angular.element("<pre contentEditable='true' ng-show='showHtml' ng-bind-html='html' ></pre>"),html:angular.element("<div contentEditable='true' ng-hide='showHtml' ng-bind-html='text' ></div>")};element.append(scope.displayElements.toolbar);element.append(scope.displayElements.text);element.append(scope.displayElements.html);$compile(scope.displayElements.text)(scope);$compile(scope.displayElements.html)(scope);element.addClass("ta-root");scope.displayElements.toolbar.addClass("ta-toolbar "+scope.classes.toolbar);scope.displayElements.text.addClass("ta-text ta-editor "+scope.classes.textEditor);scope.displayElements.html.addClass("ta-html ta-editor "+scope.classes.textEditor);scope.tools={};for(var _i=0;_i<scope.toolbar.length;_i++){group=scope.toolbar[_i];groupElement=angular.element("<div></div>");groupElement.addClass(scope.classes.toolbarGroup);for(var _j=0;_j<group.length;_j++){tool=group[_j];toolElement=angular.element($rootScope.textAngularTools[tool].display);toolElement.addClass(scope.classes.toolbarButton);toolElement.attr("unselectable","on");var childScope=angular.extend(scope.$new(true),$rootScope.textAngularTools[tool],{displayActiveToolClass:function(active){return active?this.$parent.classes.toolbarButtonActive:""}});scope.tools[tool]=childScope;groupElement.append($compile(toolElement)(childScope))}scope.displayElements.toolbar.append(groupElement)}ngModel.$render=function(){if(ngModel.$viewValue===undefined)return;if(!($document[0].activeElement===scope.displayElements.html[0])&&!($document[0].activeElement===scope.displayElements.text[0])){scope.text=sanitizationWrapper(ngModel.$viewValue);scope.html=sanitizationWrapper(ngModel.$viewValue.replace(/</g,"&lt;"))}};scope.bUpdateSelectedStyles=false;scope.updateSelectedStyles=function(){for(var _k=0;_k<scope.toolbar.length;_k++){var groups=scope.toolbar[_k];for(var _l=0;_l<groups.length;_l++){tool=groups[_l];if(scope.tools[tool].activeState!=null){scope.tools[tool].active=scope.tools[tool].activeState.apply(scope)}}}if(this.bUpdateSelectedStyles)$timeout(this.updateSelectedStyles,200)};keydown=function(e){scope.bUpdateSelectedStyles=true;scope.$apply(function(){scope.updateSelectedStyles()})};scope.displayElements.html.on("keydown",keydown);scope.displayElements.text.on("keydown",keydown);keyup=function(e){scope.bUpdateSelectedStyles=false;scope.$apply(scope.updateDisplay)};scope.displayElements.html.on("keyup",keyup);scope.displayElements.text.on("keyup",keyup);mouseup=function(e){scope.$apply(function(){scope.updateSelectedStyles()})};scope.displayElements.html.on("mouseup",mouseup);scope.displayElements.text.on("mouseup",mouseup)}}});
>>>>>>> 71c89373078fef3676582d4599f3e8ae9a68c9a6
