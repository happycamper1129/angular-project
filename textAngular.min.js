!function(){"Use Strict";function a(a,b){if(!b.display||""===b.display)throw'textAngular Error: Tool Definition for "'+a+'" does not have a valid display value';c[a]=b}var b=angular.module("textAngular",["ngSanitize"]);b.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"}});var c={};b.constant("taRegisterTool",a),b.value("taTools",c),b.config(function(a){a("html",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"Toggle HTML",action:function(){this.$editor().switchView(),this.active=this.$editor().showHtml}});for(var b=function(a){return function(){return this.$editor().queryFormatBlockState(a)}},c=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")},d=1;6>=d;d++)a("h"+d,{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"H"+d,action:c,activeState:b("h"+d)});a("p",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),a("pre",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),a("ul",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}}),a("ol",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}}),a("quote",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),a("undo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}}),a("redo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}}),a("bold",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")}}),a("justifyLeft",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(){return document.queryCommandState("justifyLeft")}}),a("justifyRight",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(){return document.queryCommandState("justifyRight")}}),a("justifyCenter",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(){return document.queryCommandState("justifyCenter")}}),a("italics",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")}}),a("underline",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")}}),a("clear",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-ban",action:function(){return this.$editor().wrapSelection("removeFormat",null)}}),a("insertImage",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-picture-o",action:function(){var a;return a=prompt("Please enter an image URL to insert","http://"),""!==a?this.$editor().wrapSelection("insertImage",a):void 0}}),a("insertLink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-link",action:function(){var a;return a=prompt("Please enter an URL to insert","http://"),""!==a?this.$editor().wrapSelection("createLink",a):void 0}}),a("unlink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-unlink",action:function(){return this.$editor().wrapSelection("unlink",null)}})}),b.directive("textAngular",["$compile","$timeout","$log","taOptions","taToolbarEditorLinker",function(a,b,c,d,e){return c.info("Thank you for using textAngular! http://www.textangular.com"),{require:"?ngModel",scope:{},restrict:"EA",link:function(c,f,g,h){var i,j,k,l,m,n=Math.floor(1e16*Math.random()),o=g.name?g.name:"textAngularEditor"+n;if(angular.extend(c,d,{wrapSelection:function(a,b){document.execCommand(a,!1,b),c.showHtml?c.displayElements.html[0].focus():c.displayElements.text[0].focus(),c.updateSelectedStyles(),c.showHtml||c.updateTaBindtext()},showHtml:!1}),g.taFocussedClass&&(c.classes.focussed=c.$eval(g.taFocussedClass)),g.taTextEditorClass&&(c.classes.textEditor=g.taTextEditorClass),g.taHtmlEditorClass&&(c.classes.htmlEditor=g.taHtmlEditorClass),l=f.html(),f.html(""),c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='html' ></div>")},f.append(c.displayElements.text),f.append(c.displayElements.html),c.displayElements.forminput.attr("name",o),f.append(c.displayElements.forminput),g.tabindex&&(c.displayElements.text.attr("tabindex",g.tabindex),c.displayElements.html.attr("tabindex",g.tabindex)),g.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(g.taDisabled),c.$parent.$watch(g.taDisabled,function(a){c.disabled=a,c.disabled?f.addClass(c.classes.disabled):f.removeClass(c.classes.disabled)})),a(c.displayElements.text)(c),a(c.displayElements.html)(c),f.addClass("ta-root"),c.displayElements.text.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.textEditor),f.on("focusin",function(){f.addClass(c.classes.focussed),m.focus(),b(function(){f.triggerHandler("focus")},0)}),f.on("focusout",function(a){return b(function(){document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]&&(f.removeClass(c.classes.focussed),m.unfocus(),b(function(){f.triggerHandler("blur")},0))},100),a.preventDefault(),!1}),c.queryFormatBlockState=function(a){a=a.toLowerCase();var b=document.queryCommandValue("formatBlock").toLowerCase();return b===a||b===a},c.switchView=function(){c.showHtml=!c.showHtml,c.showHtml?b(function(){return c.displayElements.html[0].focus()},100):b(function(){return c.displayElements.text[0].focus()},100)},g.ngModel?h.$render=function(){if(c.displayElements.forminput.val(h.$viewValue),document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]){var a=h.$viewValue||"";c.html=a}}:(c.displayElements.forminput.val(l),c.html=l),c.$watch("html",function(a,b){a!==b&&(g.ngModel&&h.$setViewValue(a),c.displayElements.forminput.val(a))}),g.taTargetToolbars)m=e.registerEditor(name,c,g.taTargetToolbars.split(","));else{var p=angular.element('<div text-angular-toolbar name="textAngularToolbar'+n+'">');g.taToolbar&&p.attr("ta-toolbar",g.taToolbar),g.taToolbarClass&&p.attr("ta-toolbar-class",g.taToolbarClass),g.taToolbarGroupClass&&p.attr("ta-toolbar-group-class",g.taToolbarGroupClass),g.taToolbarButtonClass&&p.attr("ta-toolbar-button-class",g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&p.attr("ta-toolbar-active-button-class",g.taToolbarActiveButtonClass),f.prepend(p),a(p)(c.$parent),m=e.registerEditor(o,c,["textAngularToolbar"+n])}c.bUpdateSelectedStyles=!1,c.updateSelectedStyles=function(){m.updateSelectedStyles(),c.bUpdateSelectedStyles&&b(c.updateSelectedStyles,200)},i=function(){c.bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("keydown",i),c.displayElements.text.on("keydown",i),j=function(){c.bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",j),c.displayElements.text.on("keyup",j),k=function(){c.bUpdateSelectedStyles=!1,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("mouseup",k),c.displayElements.text.on("mouseup",k)}}}]).directive("taBind",["$sanitize","taFixChrome",function(a,b){return{require:"ngModel",scope:{taBind:"@"},link:function(c,d,e,f){var g="textarea"!==d[0].tagName.toLowerCase()&&"input"!==d[0].tagName.toLowerCase()&&void 0!==d.attr("contenteditable")&&d.attr("contenteditable"),h=!1,i=function(){return b(d).html()};c.$parent["updateTaBind"+c.taBind]=function(){var a=i(),b=f.$parsers;f.$parsers=[],f.$oldViewValue=a,f.$setViewValue(a),f.$parsers=b},g&&d.on("keyup",function(){h||f.$setViewValue(i())}),f.$parsers.push(function(b){void 0===f.$oldViewValue&&(f.$oldViewValue=b);try{a(b)}catch(c){return f.$oldViewValue}return f.$oldViewValue=b,b}),f.$render=function(){var a=f.$viewValue||"";if(document.activeElement!==d[0])if(f.$oldViewValue=a,"text"===c.taBind){var b=angular.element("<div>"+a+"</div>");b.find("script").remove(),d.html(b.html()),d.find("a").on("click",function(a){return a.preventDefault(),!1})}else g||"textarea"!==d[0].tagName.toLowerCase()&&"input"!==d[0].tagName.toLowerCase()?d.html(a):d.val(a);else g||d.val(a)},e.taReadonly&&(c.$parent.$eval(e.taReadonly)?(("textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase())&&d.attr("disabled","disabled"),void 0!==d.attr("contenteditable")&&d.attr("contenteditable")&&d.removeAttr("contenteditable")):"textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase()?d.removeAttr("disabled"):g&&d.attr("contenteditable","true"),c.$parent.$watch(e.taReadonly,function(a,b){b!==a&&(a?(("textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase())&&d.attr("disabled","disabled"),void 0!==d.attr("contenteditable")&&d.attr("contenteditable")&&d.removeAttr("contenteditable")):"textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase()?d.removeAttr("disabled"):g&&d.attr("contenteditable","true"),h=a)}))}}}]).factory("taFixChrome",function(){var a=function(a){for(var b=angular.element(a).find("span"),c=0;c<b.length;c++){var d=angular.element(b[c]);d.attr("style")&&d.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(d.next().length>0&&"BR"===d.next()[0].tagName&&d.next().remove(),d.replaceWith(d.html()))}var e=a.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return e!==a.html()&&a.html(e),a};return a}).directive("textAngularToolbar",["$compile","taToolbarEditorLinker","taOptions","taTools",function(a,b,c,d){return{scope:{name:"@"},restrict:"EA",link:function(e,f,g){angular.extend(e,c),g.taToolbar&&(e.toolbar=e.$eval(g.taToolbar)),g.taToolbarClass&&(e.classes.toolbar=g.taToolbarClass),g.taToolbarGroupClass&&(e.classes.toolbarGroup=g.taToolbarGroupClass),g.taToolbarButtonClass&&(e.classes.toolbarButton=g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&(e.classes.toolbarButtonActive=g.taToolbarActiveButtonClass),e.disabled=!0,f.html(""),f.addClass("ta-toolbar "+e.classes.toolbar),setupToolElement=function(b,c,d){if(b.addClass(e.classes.toolbarButton),b.attr("unselectable","on"),b.attr("ng-disabled","isDisabled()"),b.attr("tabindex","-1"),c&&(c.buttontext&&b.html(c.buttontext),c.iconclass)){var f=angular.element("<i>");f.addClass(c.iconclass),b.append(f)}return d?a(b)(d):b},e.tools={};for(var h={$_parent:{},$editor:function(){return e.$_parent},isDisabled:function(){return"function"==typeof this.disabled&&this.disabled()||"boolean"==typeof this.disabled&&this.disabled||"html"!==this.name&&(this.$parent.disabled||this.$parent.showHtml)||void 0===this.$parent.disabled||this.$parent.disabled},displayActiveToolClass:function(a){return a?this.$parent.classes.toolbarButtonActive:""}},i=0;i<e.toolbar.length;i++){group=e.toolbar[i],groupElement=angular.element("<div>"),groupElement.addClass(e.classes.toolbarGroup);for(var j=0;j<group.length;j++){tool=group[j],toolElement=angular.element(d[tool].display);var k=angular.extend(e.$new(!0),d[tool],h,{name:tool});e.tools[tool]=k,groupElement.append(setupToolElement(toolElement,d[tool],k)),e.tools[tool].$element=toolElement}f.append(groupElement)}e.updateTool=function(a,b){var c=d[a],f=e.tools[a];if(f){var g;b.display&&""!==b.display?(g=setupToolElement(angular.element(b.display),{},f),f.$element.replaceWith(g),f.$element=g):g=f.$element,b.buttontext&&""!==b.buttontext?g.html(b.buttontext):c.buttontext&&g.html(c.buttontext);var h;if(b.iconclass?h=b.iconclass:c.iconclass&&(h=c.iconclass),g.find("i").remove(),h){var i=angular.element("<i>");i.addClass(h),g.append(i)}}},b.registerToolbar(e)}}}]).service("taToolbarEditorLinker",[function(){var a={},b={};return{registerEditor:function(c,d,e){if(b[c])throw'textAngular Error: an Editor with name "'+c+'" already exists';var f=[];return angular.forEach(e,function(b){f[b]||f.push(a[b])}),b[c]={scope:d,toolbars:e,_registerToolbar:function(a){this.toolbars.indexOf(a.name)>=0&&f.push(a)}},{disable:function(){angular.forEach(f,function(a){a.disabled=!0})},enable:function(){angular.forEach(f,function(a){a.disabled=!1})},focus:function(){angular.forEach(f,function(a){a.$_parent=d,a.disabled=!1})},unfocus:function(){return this.disable()},updateSelectedStyles:function(){angular.forEach(f,function(a){angular.forEach(a.tools,function(a){a.activeState&&(a.active=a.activeState(d))})})}}},registerToolbar:function(c){if(a[c.name])throw'textAngular Error: a Toolbar with name "'+c.name+'" already exists';a[c.name]=c,angular.forEach(b,function(a){a._registerToolbar(c)})},updateTools:function(a){var b=this;angular.forEach(a,function(a,c){b.updateTool(c,a)})},resetTools:function(){var a=this;angular.forEach(c,function(b,c){a.resetTool(c)})},updateTool:function(b,c){var d=this;angular.forEach(a,function(a,e){d.updateToolbarTool(e,b,c)})},resetTool:function(b){var d=this;angular.forEach(a,function(a,e){d.resetToolbarTool(e,b,c[b])})},updateToolbarTool:function(b,c,d){a[b]&&a[b].updateTool(c,d)},resetToolbarTool:function(b,d){a[b]&&a[b].updateTool(d,c[d])}}}])}();