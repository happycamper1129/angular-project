!function(){"Use Strict";function t(t,e){a[t]=e}var e=angular.module("textAngular",["ngSanitize"]);e.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",toolbarButtonDisabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"}});var a={};e.constant("taRegisterTool",t),e.value("taTools",a),e.config(function(t){t("html",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"Toggle HTML",action:function(){this.$parent.switchView(),this.active=this.$parent.showHtml}});for(var e=function(t){return function(){return this.queryFormatBlockState(t)}},a=1;6>=a;a++)t("h"+a,{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"H"+a,action:function(){return this.$parent.wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")},activeState:e("h"+a)});t("p",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"P",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return this.queryFormatBlockState("p")}}),t("pre",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"pre",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.queryFormatBlockState("pre")}}),t("ul",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ul",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}}),t("ol",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ol",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}}),t("quote",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-quote-right",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.queryFormatBlockState("blockquote")}}),t("undo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-undo",action:function(){return this.$parent.wrapSelection("undo",null)}}),t("redo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-repeat",action:function(){return this.$parent.wrapSelection("redo",null)}}),t("bold",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-bold",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")}}),t("justifyLeft",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-left",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return document.queryCommandState("justifyLeft")}}),t("justifyRight",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-right",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return document.queryCommandState("justifyRight")}}),t("justifyCenter",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-center",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return document.queryCommandState("justifyCenter")}}),t("italics",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-italic",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")}}),t("underline",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-underline",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")}}),t("clear",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-ban",action:function(){return this.$parent.wrapSelection("removeFormat",null)}}),t("insertImage",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-picture-o",action:function(){var t;return t=prompt("Please enter an image URL to insert","http://"),""!==t?this.$parent.wrapSelection("insertImage",t):void 0}}),t("insertLink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-link",action:function(){var t;return t=prompt("Please enter an URL to insert","http://"),""!==t?this.$parent.wrapSelection("createLink",t):void 0}}),t("unlink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-unlink",action:function(){return this.$parent.wrapSelection("unlink",null)}})}),e.directive("textAngular",["$compile","$timeout","taOptions","taTools","$log",function(t,e,a,n,l){return l.info("Thank you for using textAngular! http://www.textangular.com"),{require:"?ngModel",scope:{},restrict:"EA",link:function(l,o,i,s){var r,c,u,d,p,m;angular.extend(l,a,{wrapSelection:function(t,e){document.execCommand(t,!1,e),l.showHtml?l.displayElements.html[0].focus():l.displayElements.text[0].focus(),l.updateSelectedStyles(),l.showHtml||l.updateTaBindtext()},showHtml:!1}),i.taToolbar&&(l.toolbar=l.$eval(i.taToolbar)),i.taFocussedClass&&(l.classes.focussed=l.$eval(i.taFocussedClass)),i.taToolbarClass&&(l.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(l.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(l.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),i.taTextEditorClass&&(l.classes.textEditor=i.taTextEditorClass),i.taHtmlEditorClass&&(l.classes.htmlEditor=i.taHtmlEditorClass);var f=o.html();o.html(""),l.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")},o.append(l.displayElements.toolbar),o.append(l.displayElements.text),o.append(l.displayElements.html),i.name&&(l.displayElements.forminput.attr("name",i.name),o.append(l.displayElements.forminput)),i.taDisabled&&(l.displayElements.text.attr("ta-readonly","disabled"),l.displayElements.html.attr("ta-readonly","disabled"),l.disabled=l.$parent.$eval(i.taDisabled),l.$parent.$watch(i.taDisabled,function(t){l.disabled=t,l.disabled?o.addClass(l.classes.toolbarButtonDisabled):o.removeClass(l.classes.toolbarButtonDisabled)})),t(l.displayElements.text)(l),t(l.displayElements.html)(l),o.addClass("ta-root"),l.displayElements.toolbar.addClass("ta-toolbar "+l.classes.toolbar),l.displayElements.text.addClass("ta-text ta-editor "+l.classes.textEditor),l.displayElements.html.addClass("ta-html ta-editor "+l.classes.textEditor),o.on("focusin",function(){o.addClass(l.classes.focussed),e(function(){o.triggerHandler("focus")},0)}),o.on("focusout",function(){e(function(){document.activeElement!==l.displayElements.html[0]&&document.activeElement!==l.displayElements.text[0]&&(o.removeClass(l.classes.focussed),e(function(){o.triggerHandler("blur")},0))},0)}),l.queryFormatBlockState=function(t){t=t.toLowerCase();var e=document.queryCommandValue("formatBlock").toLowerCase();return e===t||e===t},l.switchView=function(){l.showHtml=!l.showHtml,l.showHtml?e(function(){return l.displayElements.html[0].focus()},100):e(function(){return l.displayElements.text[0].focus()},100)},l.tools={};for(var y=0;y<l.toolbar.length;y++){r=l.toolbar[y],c=angular.element("<div>"),c.addClass(l.classes.toolbarGroup);for(var b=0;b<r.length;b++){if(p=r[b],m=angular.element(n[p].display),m.addClass(l.classes.toolbarButton),m.attr("unselectable","on"),m.attr("ng-disabled","isDisabled()"),n[p].buttontext&&m.html(n[p].buttontext),n[p].iconclass){var v=angular.element("<i>");v.addClass(n[p].iconclass),m.append(v)}var h=angular.extend(l.$new(!0),n[p],{name:p,isDisabled:function(){return"function"==typeof this.disabled&&this.disabled()||"boolean"==typeof this.disabled&&this.disabled||"html"!==this.name&&(this.$parent.disabled||this.$parent.showHtml)||this.$parent.disabled},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});l.tools[p]=h,c.append(t(m)(h))}l.displayElements.toolbar.append(c)}i.ngModel?s.$render=function(){if(l.displayElements.forminput.val(s.$viewValue),document.activeElement!==l.displayElements.html[0]&&document.activeElement!==l.displayElements.text[0]){var t=s.$viewValue||"";l.text=t,l.html=t}}:(l.displayElements.forminput.val(f),l.text=f,l.html=f),l.$watch("text",function(t,e){l.html=t,i.ngModel&&t!==e&&s.$setViewValue(t),l.displayElements.forminput.val(t)}),l.$watch("html",function(t,e){l.text=t,i.ngModel&&t!==e&&s.$setViewValue(t),l.displayElements.forminput.val(t)}),l.bUpdateSelectedStyles=!1,l.updateSelectedStyles=function(){for(var t=0;t<l.toolbar.length;t++)for(var a=l.toolbar[t],n=0;n<a.length;n++)p=a[n],null!=l.tools[p].activeState&&(l.tools[p].active=l.tools[p].activeState.apply(l));l.bUpdateSelectedStyles&&e(l.updateSelectedStyles,200)};var u=function(){l.bUpdateSelectedStyles=!0,l.$apply(function(){l.updateSelectedStyles()})};l.displayElements.html.on("keydown",u),l.displayElements.text.on("keydown",u);var d=function(){l.bUpdateSelectedStyles=!1};l.displayElements.html.on("keyup",d),l.displayElements.text.on("keyup",d);var g=function(){l.$apply(function(){l.updateSelectedStyles()})};l.displayElements.html.on("mouseup",g),l.displayElements.text.on("mouseup",g)}}}]).directive("taBind",["$sanitize","taFixChrome",function(t,e){return{require:"ngModel",scope:{taBind:"@"},link:function(a,n,l,o){var i="textarea"!==n[0].tagName.toLowerCase()&&"input"!==n[0].tagName.toLowerCase()&&void 0!==n.attr("contenteditable")&&n.attr("contenteditable"),s=!1,r=function(){var t=e(n).html();return"html"===a.taBind&&i&&(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),t};a.$parent["updateTaBind"+a.taBind]=function(){var t=r(),e=o.$parsers;o.$parsers=[],o.$oldViewValue=t,o.$setViewValue(t),o.$parsers=e},i&&n.on("keyup",function(){s||o.$setViewValue(r())}),o.$parsers.push(function(e){void 0===o.$oldViewValue&&(o.$oldViewValue=e);try{t(e)}catch(a){return o.$oldViewValue}return o.$oldViewValue=e,e}),o.$render=function(){if(document.activeElement!==n[0]){var t=o.$viewValue||"";if(o.$oldViewValue=t,"text"===a.taBind){var e=angular.element("<div>"+t+"</div>");e.find("script").remove(),n.html(e.html()),n.find("a").on("click",function(t){return t.preventDefault(),!1})}else i||"textarea"!==n[0].tagName.toLowerCase()&&"input"!==n[0].tagName.toLowerCase()?n.html(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):n.val(t)}else i||n.val(t)},l.taReadonly&&(a.$parent.$eval(l.taReadonly)?(("textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase())&&n.attr("disabled","disabled"),void 0!==n.attr("contenteditable")&&n.attr("contenteditable")&&n.removeAttr("contenteditable")):"textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase()?n.removeAttr("disabled"):i&&n.attr("contenteditable","true"),a.$parent.$watch(l.taReadonly,function(t,e){e!==t&&(t?(("textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase())&&n.attr("disabled","disabled"),void 0!==n.attr("contenteditable")&&n.attr("contenteditable")&&n.removeAttr("contenteditable")):"textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase()?n.removeAttr("disabled"):i&&n.attr("contenteditable","true"),s=t)}))}}}]).factory("taFixChrome",function(){var t=function(t){for(var e=angular.element(t).find("span"),a=0;a<e.length;a++){var n=angular.element(e[a]);n.attr("style")&&n.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n.next().length>0&&"BR"===n.next()[0].tagName&&n.next().remove(),n.replaceWith(n.html()))}var l=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return l!==t.html()&&t.html(l),t};return t})}();