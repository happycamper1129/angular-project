!function(){"Use Strict";function a(a,b){if(!a||""===a||c.hasOwnProperty(a))throw"textAngular Error: A unique name is required for a Tool Definition";if(b.display&&(""===b.display||0===angular.element(b.display).length)||!b.display&&!b.buttontext&&!b.iconclass)throw'textAngular Error: Tool Definition for "'+a+'" does not have a valid display/iconclass/buttontext value';c[a]=b}var b=angular.module("textAngular",["ngSanitize"]);b.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"}});var c={};b.constant("taRegisterTool",a),b.value("taTools",c),b.config(["taRegisterTool",function(a){angular.forEach(c,function(a,b){delete c[b]}),a("html",{buttontext:"Toggle HTML",action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var b=function(a){return function(){return this.$editor().queryFormatBlockState(a)}},d=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(c){a(c.toLowerCase(),{buttontext:c.toUpperCase(),action:d,activeState:b(c.toLowerCase())})}),a("p",{buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),a("pre",{buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),a("ul",{iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}}),a("ol",{iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}}),a("quote",{iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),a("undo",{iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}}),a("redo",{iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}}),a("bold",{iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")},commandKeyCode:98}),a("justifyLeft",{iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(a){var b=!1;return a&&(b="left"===a.css("text-align")||""===a.css("text-align")),b=b||document.queryCommandState("justifyLeft")}}),a("justifyRight",{iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(a){var b=!1;return a&&(b="right"===a.css("text-align")),b=b||document.queryCommandState("justifyRight")}}),a("justifyCenter",{iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(a){var b=!1;return a&&(b="center"===a.css("text-align")),b=b||document.queryCommandState("justifyCenter")}}),a("italics",{iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")},commandKeyCode:105}),a("underline",{iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")},commandKeyCode:117}),a("clear",{iconclass:"fa fa-ban",action:function(){return this.$editor().wrapSelection("removeFormat",null)}}),a("insertImage",{iconclass:"fa fa-picture-o",action:function(){var a;return a=prompt("Please enter an image URL to insert","http://"),""!==a&&"http://"!==a?this.$editor().wrapSelection("insertImage",a):void 0}}),a("insertLink",{iconclass:"fa fa-link",action:function(){var a;return a=prompt("Please enter an URL to insert","http://"),""!==a&&"http://"!==a?this.$editor().wrapSelection("createLink",a):void 0},activeState:function(a){return a?"A"===a[0].tagName:!1}}),a("unlink",{iconclass:"fa fa-unlink",action:function(){return this.$editor().wrapSelection("unlink",null)},activeState:function(a){return a?"A"===a[0].tagName:!1}})}]),b.directive("textAngular",["$compile","$timeout","$log","taOptions","taSanitize","textAngularManager",function(a,b,c,d,e,f){return c.info("Thank you for using textAngular! http://www.textangular.com"),{require:"?ngModel",scope:{},restrict:"EA",link:function(c,e,g,h){var i,j,k,l,m,n,o,p,q=Math.floor(1e16*Math.random()),r=g.name?g.name:"textAngularEditor"+q;angular.extend(c,angular.copy(d),{wrapSelection:function(a,b){document.execCommand(a,!1,b),c.displayElements.text[0].focus()},showHtml:!1}),g.taFocussedClass&&(c.classes.focussed=g.taFocussedClass),g.taTextEditorClass&&(c.classes.textEditor=g.taTextEditorClass),g.taHtmlEditorClass&&(c.classes.htmlEditor=g.taHtmlEditorClass),o=e.html(),e.html(""),c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea id='taHtmlElement' ng-show='showHtml' ta-bind ng-model='html'></textarea>"),text:angular.element("<div id='taTextElement' contentEditable='true' ng-hide='showHtml' ta-bind ng-model='html'></div>")},e.append(c.displayElements.text),e.append(c.displayElements.html),c.displayElements.forminput.attr("name",r),e.append(c.displayElements.forminput),g.tabindex&&(c.displayElements.text.attr("tabindex",g.tabindex),c.displayElements.html.attr("tabindex",g.tabindex)),g.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(g.taDisabled),c.$parent.$watch(g.taDisabled,function(a){c.disabled=a,c.disabled?e.addClass(c.classes.disabled):e.removeClass(c.classes.disabled)})),a(c.displayElements.text)(c),a(c.displayElements.html)(c),e.addClass("ta-root"),c.displayElements.text.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.textEditor),c._actionRunning=!1;var s=!1;if(c.startAction=function(){return c._actionRunning=!0,window.rangy&&window.rangy.saveSelection?(s=window.rangy.saveSelection(),function(){window.rangy.restoreSelection(s)}):void 0},c.endAction=function(){c._actionRunning=!1,s&&rangy.removeMarkers(s),s=!1,c.updateSelectedStyles(),c.showHtml||c.updateTaBindtaTextElement()},m=function(){e.addClass(c.classes.focussed),e.find("[contenteditable=true]").text()===g.placeholder&&e.find("[contenteditable=true]").hasClass("placeholder-text")&&(e.find("[contenteditable=true]").removeClass("placeholder-text"),e.find("[contenteditable=true]").text("")),p.focus()},c.displayElements.html.on("focus",m),c.displayElements.text.on("focus",m),n=function(a){return b(function(){document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]&&(e.removeClass(c.classes.focussed),g.placeholder&&""===e.find("[contenteditable=true]").text()&&(e.find("[contenteditable=true]").text(g.placeholder),e.find("[contenteditable=true]").addClass("placeholder-text")),c._actionRunning||p.unfocus(),b(function(){e.triggerHandler("blur")},0))},100),a.preventDefault(),!1},c.displayElements.html.on("blur",n),c.displayElements.text.on("blur",n),c.queryFormatBlockState=function(a){a=a.toLowerCase();var b=document.queryCommandValue("formatBlock").toLowerCase();return b===a||b===a},c.switchView=function(){c.showHtml=!c.showHtml,c.showHtml?b(function(){return c.displayElements.html[0].focus()},100):b(function(){return c.displayElements.text[0].focus()},100)},g.ngModel){var t=!0;h.$render=function(){if(t){t=!1;var a=c.$parent.$eval(g.ngModel);void 0!==a&&null!==a||!o||""===o||h.$setViewValue(o)}c.displayElements.forminput.val(h.$viewValue),document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]&&(c.html=h.$viewValue||"")}}else c.displayElements.forminput.val(o),c.html=o;if(c.$watch("html",function(a,b){a!==b&&(g.ngModel&&h.$setViewValue(a),c.displayElements.forminput.val(a))}),g.taTargetToolbars)p=f.registerEditor(r,c,g.taTargetToolbars.split(","));else{var u=angular.element('<div text-angular-toolbar name="textAngularToolbar'+q+'">');g.taToolbar&&u.attr("ta-toolbar",g.taToolbar),g.taToolbarClass&&u.attr("ta-toolbar-class",g.taToolbarClass),g.taToolbarGroupClass&&u.attr("ta-toolbar-group-class",g.taToolbarGroupClass),g.taToolbarButtonClass&&u.attr("ta-toolbar-button-class",g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&u.attr("ta-toolbar-active-button-class",g.taToolbarActiveButtonClass),g.taFocussedClass&&u.attr("ta-focussed-class",g.taFocussedClass),e.prepend(u),a(u)(c.$parent),p=f.registerEditor(r,c,["textAngularToolbar"+q])}c.$on("$destroy",function(){f.unregisterEditor(r)}),c._bUpdateSelectedStyles=!1,c.updateSelectedStyles=function(){var a;window.rangy&&window.rangy.getSelection&&1===(a=window.rangy.getSelection().getAllRanges()).length?p.updateSelectedStyles(angular.element(a[0].commonAncestorContainer.parentNode)):p.updateSelectedStyles(),c._bUpdateSelectedStyles&&b(c.updateSelectedStyles,200)},i=function(){c._bUpdateSelectedStyles||(c._bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()}))},c.displayElements.html.on("keydown",i),c.displayElements.text.on("keydown",i),j=function(){c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",j),c.displayElements.text.on("keyup",j),k=function(a){return p.sendKeyCommand(a)?(c._bUpdateSelectedStyles||c.$apply(function(){c.updateSelectedStyles()}),a.preventDefault(),!1):void 0},c.displayElements.html.on("keypress",k),c.displayElements.text.on("keypress",k),l=function(){c._bUpdateSelectedStyles=!1,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("mouseup",l),c.displayElements.text.on("mouseup",l),g.placeholder&&(e.find("[contenteditable=true]").text(g.placeholder),e.find("[contenteditable=true]").attr("placeholder",g.placeholder))}}}]).directive("taBind",["taSanitize","$timeout",function(a,b){return{require:"ngModel",scope:{},link:function(c,d,e,f){var g=void 0!==d.attr("contenteditable")&&d.attr("contenteditable"),h=g||"textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase(),i=!1,j=function(){if(g)return d.html();if(h)return d.val();throw"textAngular Error: attempting to update non-editable taBind"};c.$parent["updateTaBind"+(e.id||"")]=function(){i||f.$setViewValue(j())},h&&(d.on("keyup",function(){i||f.$setViewValue(j())}),d.on("paste cut",function(){i||b(function(){f.$setViewValue(j())},0)})),h&&!g&&d.on("change blur",function(){i||f.$setViewValue(j())});var k=function(b){return f.$oldViewValue=a(b,f.$oldViewValue)};f.$parsers.push(k),f.$formatters.push(k),f.$render=function(){if(document.activeElement!==d[0]){var a=f.$viewValue||"";g?(""===a&&"true"===d.attr("contenteditable")&&d.attr("placeholder")?(d.html(d.attr("placeholder")),d.addClass("placeholder-text")):d.html(a),i||d.find("a").on("click",function(a){return a.preventDefault(),!1})):"textarea"!==d[0].tagName.toLowerCase()&&"input"!==d[0].tagName.toLowerCase()?d.html(a):d.val(a)}},e.taReadonly&&(i=c.$parent.$eval(e.taReadonly),i?(("textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase())&&d.attr("disabled","disabled"),void 0!==d.attr("contenteditable")&&d.attr("contenteditable")&&d.removeAttr("contenteditable")):"textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase()?d.removeAttr("disabled"):g&&d.attr("contenteditable","true"),c.$parent.$watch(e.taReadonly,function(a,b){b!==a&&(a?(("textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase())&&d.attr("disabled","disabled"),void 0!==d.attr("contenteditable")&&d.attr("contenteditable")&&d.removeAttr("contenteditable")):"textarea"===d[0].tagName.toLowerCase()||"input"===d[0].tagName.toLowerCase()?d.removeAttr("disabled"):g&&d.attr("contenteditable","true"),i=a)}))}}}]).factory("taSanitize",["$sanitize",function(a){function b(a,c){var d=[],e=a.children();return e.length&&angular.forEach(e,function(a){d=d.concat(b(angular.element(a),c))}),a.attr(c)&&d.push(a),d}return function(c,d){var e=angular.element("<div>"+c+"</div>");angular.forEach(b(e,"align"),function(a){a.css("text-align",a.attr("align")),a.removeAttr("align")}),c=e.html();var f;try{f=a(c)}catch(g){f=d||""}return f}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction",function(a,b,c,d,e){return{scope:{name:"@"},restrict:"EA",link:function(f,g,h){if(!f.name||""===f.name)throw"textAngular Error: A toolbar requires a name";angular.extend(f,angular.copy(c)),h.taToolbar&&(f.toolbar=f.$parent.$eval(h.taToolbar)),h.taToolbarClass&&(f.classes.toolbar=h.taToolbarClass),h.taToolbarGroupClass&&(f.classes.toolbarGroup=h.taToolbarGroupClass),h.taToolbarButtonClass&&(f.classes.toolbarButton=h.taToolbarButtonClass),h.taToolbarActiveButtonClass&&(f.classes.toolbarButtonActive=h.taToolbarActiveButtonClass),h.taFocussedClass&&(f.classes.focussed=h.taFocussedClass),f.disabled=!0,f.focussed=!1,g.html(""),g.addClass("ta-toolbar "+f.classes.toolbar),f.$watch("focussed",function(){f.focussed?g.addClass(f.classes.focussed):g.removeClass(f.classes.focussed)}),setupToolElement=function(b,c){var d;if(b&&b.display?(d=angular.element(b.display),c._display=b.display):d=angular.element(c._display?c._display:"<button type='button'>"),d.addClass(f.classes.toolbarButton),d.attr("name",c.name),d.attr("unselectable","on"),d.attr("ng-disabled","isDisabled()"),d.attr("tabindex","-1"),d.attr("ng-click","executeAction()"),d.attr("ng-class","displayActiveToolClass(active)"),d.on("mousedown",function(a){return a.preventDefault(),!1}),b&&!b.display&&!c._display&&(d.html(""),b.buttontext&&d.html(b.buttontext),b.iconclass)){var e=angular.element("<i>"),g=d.html();e.addClass(b.iconclass),d.html(""),d.append(e),g&&""!==g&&d.append("&nbsp;"+g)}return a(d)(c)},f.tools={},f._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1}};var i={$editor:function(){return f._parent},isDisabled:function(){return this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(a){return a?f.classes.toolbarButtonActive:""},executeAction:e};angular.forEach(f.toolbar,function(a){groupElement=angular.element("<div>"),groupElement.addClass(f.classes.toolbarGroup),angular.forEach(a,function(a){var b=angular.extend(f.$new(!0),d[a],i,{name:a});f.tools[a]=b,f.tools[a].$element=setupToolElement(d[a],b),groupElement.append(f.tools[a].$element)}),g.append(groupElement)}),f.updateToolDisplay=function(a,b){var c=d[a],e=f.tools[a];e&&(null===b.buttontext?delete b.buttontext:!b.buttontext&&c.buttontext&&(b.buttontext=c.buttontext),null===b.iconclass?delete b.iconclass:!b.iconclass&&c.iconclass&&(b.iconclass=c.iconclass),null===b.display?(delete b.display,delete e._display):!e._display&&c.display&&(b.display=c.display),toolElement=setupToolElement(b,e),e.$element.replaceWith(toolElement),e.$element=toolElement)},b.registerToolbar(f),f.$on("$destroy",function(){b.unregisterToolbar(f.name)})}}}]).service("taToolExecuteAction",["$q",function(a){return function(b){!this.$editor&&b&&(this.$editor=function(){return b});var c=a.defer(),d=c.promise;d["finally"](this.$editor().endAction);var e;try{e=this.action(c,this.$editor().startAction())}catch(f){}(e||void 0===e)&&c.resolve()}}]).service("textAngularManager",["taToolExecuteAction",function(a){var b={},d={};return{registerEditor:function(e,f,g){if(!e||""===e)throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(d[e])throw'textAngular Error: An Editor with name "'+e+'" already exists';var h=[];return angular.forEach(g,function(a){b[a]&&h.push(b[a])}),d[e]={scope:f,toolbars:g,_registerToolbar:function(a){this.toolbars.indexOf(a.name)>=0&&h.push(a)}},{disable:function(){angular.forEach(h,function(a){a.disabled=!0})},enable:function(){angular.forEach(h,function(a){a.disabled=!1})},focus:function(){angular.forEach(h,function(a){a._parent=f,a.disabled=!1,a.focussed=!0})},unfocus:function(){angular.forEach(h,function(a){a.disabled=!0,a.focussed=!1})},updateSelectedStyles:function(a){angular.forEach(h,function(b){angular.forEach(b.tools,function(b){b.activeState&&(b.active=b.activeState(a))})})},sendKeyCommand:function(b){var d=!1;return(b.ctrlKey||b.metaKey)&&angular.forEach(c,function(c){c.commandKeyCode&&c.commandKeyCode===b.which&&(a.call(c,f),d=!0)}),d}}},retrieveEditor:function(a){return d[a]},unregisterEditor:function(a){delete d[a]},registerToolbar:function(a){if(!a)throw"textAngular Error: A toolbar requires a scope";if(!a.name||""===a.name)throw"textAngular Error: A toolbar requires a name";if(b[a.name])throw'textAngular Error: A toolbar with name "'+a.name+'" already exists';b[a.name]=a,angular.forEach(d,function(b){b._registerToolbar(a)})},retrieveToolbar:function(a){return b[a]},retrieveToolbarsViaEditor:function(a){var b=[],c=this;return angular.forEach(this.retrieveEditor(a).toolbars,function(a){b.push(c.retrieveToolbar(a))}),b},unregisterToolbar:function(a){delete b[a]},updateToolsDisplay:function(a){var b=this;angular.forEach(a,function(a,c){b.updateToolDisplay(c,a)})},resetToolsDisplay:function(){var a=this;angular.forEach(c,function(b,c){a.resetToolDisplay(c)})},updateToolDisplay:function(a,c){var d=this;angular.forEach(b,function(b,e){d.updateToolbarToolDisplay(e,a,c)})},resetToolDisplay:function(a){var c=this;angular.forEach(b,function(b,d){c.resetToolbarToolDisplay(d,a)})},updateToolbarToolDisplay:function(a,c,d){b[a]&&b[a].updateToolDisplay(c,d)},resetToolbarToolDisplay:function(a,d){b[a]&&b[a].updateToolDisplay(d,c[d])},refreshEditor:function(a){if(!d[a])throw'textAngular Error: No Editor with name "'+a+'" exists';d[a].scope.updateTaBindtaTextElement(),d[a].scope.$$phase||d[a].scope.$digest()}}}])}();