!function(){"Use Strict";function a(a,b){if(!a||""===a)throw"textAngular Error: A name is required for a Tool Definition";if(!b.display||""===b.display||0===angular.element(b.display).length)throw'textAngular Error: Tool Definition for "'+a+'" does not have a valid display value';c[a]=b}var b=angular.module("textAngular",["ngSanitize"]);b.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"}});var c={};b.constant("taRegisterTool",a),b.value("taTools",c),b.config(["taRegisterTool",function(a){a("html",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",buttontext:"Toggle HTML",action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var b=function(a){return function(){return this.$editor().queryFormatBlockState(a)}},c=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(d){a(d.toLowerCase(),{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",buttontext:d.toUpperCase(),action:c,activeState:b(d.toLowerCase())})}),a("p",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),a("pre",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),a("ul",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}}),a("ol",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}}),a("quote",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),a("undo",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}}),a("redo",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}}),a("bold",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")}}),a("justifyLeft",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(a){var b=!0;return a&&(b="left"===a.css("text-align")||""===a.css("text-align")),b=b||document.queryCommandState("justifyLeft")}}),a("justifyRight",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(a){var b=!0;return a&&(b="right"===a.css("text-align")),b=b||document.queryCommandState("justifyRight")}}),a("justifyCenter",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(a){var b=!0;return a&&(b="center"===a.css("text-align")),b=b||document.queryCommandState("justifyCenter")}}),a("italics",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")}}),a("underline",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")}}),a("clear",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-ban",action:function(){return this.$editor().wrapSelection("removeFormat",null)}}),a("insertImage",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-picture-o",action:function(){var a;return a=prompt("Please enter an image URL to insert","http://"),""!==a&&"http://"!==a?this.$editor().wrapSelection("insertImage",a):void 0}}),a("insertLink",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-link",action:function(){var a;return a=prompt("Please enter an URL to insert","http://"),""!==a&&"http://"!==a?this.$editor().wrapSelection("createLink",a):void 0},activeState:function(a){return a?"A"===a[0].tagName:!1}}),a("unlink",{display:"<button type='button' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-unlink",action:function(){return this.$editor().wrapSelection("unlink",null)},activeState:function(a){return a?"A"===a[0].tagName:!1}})}]),b.directive("textAngular",["$compile","$timeout","$log","taOptions","taSanitize","textAngularManager",function(a,b,c,d,e,f){return c.info("Thank you for using textAngular! http://www.textangular.com"),{require:"?ngModel",scope:{},restrict:"EA",link:function(c,e,g,h){var i,j,k,l,m,n=Math.floor(1e16*Math.random()),o=g.name?g.name:"textAngularEditor"+n;angular.extend(c,d,{wrapSelection:function(a,b){document.execCommand(a,!1,b),c.showHtml?c.displayElements.html[0].focus():c.displayElements.text[0].focus()},showHtml:!1}),g.taFocussedClass&&(c.classes.focussed=c.$eval(g.taFocussedClass)),g.taTextEditorClass&&(c.classes.textEditor=g.taTextEditorClass),g.taHtmlEditorClass&&(c.classes.htmlEditor=g.taHtmlEditorClass),l=e.html(),e.html(""),c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea id='taHtmlElement' ng-show='showHtml' ta-bind ng-model='html'></textarea>"),text:angular.element("<div id='taTextElement' contentEditable='true' ng-hide='showHtml' ta-bind ng-model='html'></div>")},e.append(c.displayElements.text),e.append(c.displayElements.html),c.displayElements.forminput.attr("name",o),e.append(c.displayElements.forminput),g.tabindex&&(c.displayElements.text.attr("tabindex",g.tabindex),c.displayElements.html.attr("tabindex",g.tabindex)),g.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(g.taDisabled),c.$parent.$watch(g.taDisabled,function(a){c.disabled=a,c.disabled?e.addClass(c.classes.disabled):e.removeClass(c.classes.disabled)})),a(c.displayElements.text)(c),a(c.displayElements.html)(c),e.addClass("ta-root"),c.displayElements.text.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.textEditor),c._actionRunning=!1;var p=!1;if(c.startAction=function(){return c._actionRunning=!0,window.rangy&&window.rangy.saveSelection?(p=window.rangy.saveSelection(),function(){window.rangy.restoreSelection(p)}):void 0},c.endAction=function(){c._actionRunning=!1,p&&rangy.removeMarkers(p),p=!1,c.updateSelectedStyles(),c.showHtml||c.updateTaBindtaTextElement()},e.on("focusin",function(){e.addClass(c.classes.focussed),m.focus(),b(function(){c.showHtml?c.displayElements.html[0].focus():c.displayElements.text[0].focus()},0)}),e.on("focusout",function(a){return b(function(){document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]&&(e.removeClass(c.classes.focussed),c._actionRunning||m.unfocus(),b(function(){e.triggerHandler("blur")},0))},100),a.preventDefault(),!1}),c.queryFormatBlockState=function(a){a=a.toLowerCase();var b=document.queryCommandValue("formatBlock").toLowerCase();return b===a||b===a},c.switchView=function(){c.showHtml=!c.showHtml,c.showHtml?b(function(){return c.displayElements.html[0].focus()},100):b(function(){return c.displayElements.text[0].focus()},100)},g.ngModel?(h.$render=function(){c.displayElements.forminput.val(h.$viewValue),document.activeElement!==c.displayElements.html[0]&&document.activeElement!==c.displayElements.text[0]&&(c.html=h.$viewValue||"")},void 0===h.$viewValue&&void 0!==originalContents&&h.$setViewValue(originalContents)):(c.displayElements.forminput.val(l),c.html=l),c.$watch("html",function(a,b){a!==b&&(g.ngModel&&h.$setViewValue(a),c.displayElements.forminput.val(a))}),g.taTargetToolbars)m=f.registerEditor(o,c,g.taTargetToolbars.split(","));else{var q=angular.element('<div text-angular-toolbar name="textAngularToolbar'+n+'">');g.taToolbar&&q.attr("ta-toolbar",g.taToolbar),g.taToolbarClass&&q.attr("ta-toolbar-class",g.taToolbarClass),g.taToolbarGroupClass&&q.attr("ta-toolbar-group-class",g.taToolbarGroupClass),g.taToolbarButtonClass&&q.attr("ta-toolbar-button-class",g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&q.attr("ta-toolbar-active-button-class",g.taToolbarActiveButtonClass),e.prepend(q),a(q)(c.$parent),m=f.registerEditor(o,c,["textAngularToolbar"+n])}c._bUpdateSelectedStyles=!1,c.updateSelectedStyles=function(){var a;window.rangy&&window.rangy.getSelection&&1===(a=window.rangy.getSelection().getAllRanges()).length?m.updateSelectedStyles(angular.element(a[0].commonAncestorContainer.parentNode)):m.updateSelectedStyles(),c._bUpdateSelectedStyles&&b(c.updateSelectedStyles,200)},i=function(){c._bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("keydown",i),c.displayElements.text.on("keydown",i),j=function(){c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",j),c.displayElements.text.on("keyup",j),k=function(){c._bUpdateSelectedStyles=!1,c.$apply(function(){c.updateSelectedStyles()})},c.displayElements.html.on("mouseup",k),c.displayElements.text.on("mouseup",k)}}}]).directive("taBind",["taSanitize",function(a){return{require:"ngModel",scope:{},link:function(b,c,d,e){var f=void 0!==c.attr("contenteditable")&&c.attr("contenteditable"),g=f||"textarea"===c[0].tagName.toLowerCase()||"input"===c[0].tagName.toLowerCase(),h=!1,i=function(){if(f)return c.html();if(g)return c.val();throw"textAngular Error: attempting to compile non-editable taBind"};b.$parent["updateTaBind"+(d.id||"")]=function(){g&&!h&&e.$setViewValue(i())},g&&c.on("keyup paste cut",function(){h||e.$setViewValue(i())}),g&&!f&&c.on("change blur",function(){h||e.$setViewValue(i())});var j=function(b){return e.$oldViewValue=a(b,e.$oldViewValue)};e.$parsers.push(j),e.$formatters.push(j),e.$render=function(){if(document.activeElement!==c[0]){var a=e.$viewValue||"";f?(c.html(a),h||c.find("a").on("click",function(a){return a.preventDefault(),!1})):"textarea"!==c[0].tagName.toLowerCase()&&"input"!==c[0].tagName.toLowerCase()?c.html(a):c.val(a)}},d.taReadonly&&(b.$parent.$eval(d.taReadonly)?(("textarea"===c[0].tagName.toLowerCase()||"input"===c[0].tagName.toLowerCase())&&c.attr("disabled","disabled"),void 0!==c.attr("contenteditable")&&c.attr("contenteditable")&&c.removeAttr("contenteditable")):"textarea"===c[0].tagName.toLowerCase()||"input"===c[0].tagName.toLowerCase()?c.removeAttr("disabled"):f&&c.attr("contenteditable","true"),b.$parent.$watch(d.taReadonly,function(a,b){b!==a&&(a?(("textarea"===c[0].tagName.toLowerCase()||"input"===c[0].tagName.toLowerCase())&&c.attr("disabled","disabled"),void 0!==c.attr("contenteditable")&&c.attr("contenteditable")&&c.removeAttr("contenteditable")):"textarea"===c[0].tagName.toLowerCase()||"input"===c[0].tagName.toLowerCase()?c.removeAttr("disabled"):f&&c.attr("contenteditable","true"),h=a)}))}}}]).factory("taSanitize",["$sanitize",function(a){function b(a,c){var d=[],e=a.children();return e.length&&angular.forEach(e,function(a){d=d.concat(b(angular.element(a),c))}),a.attr(c)&&d.push(a),d}return function(c,d){var e=angular.element("<div>"+c+"</div>");angular.forEach(b(e,"align"),function(a){a.css("text-align",a.attr("align")),a.removeAttr("align")}),c=e.html();var f;try{f=a(c)}catch(g){f=d||""}return f}}]).directive("textAngularToolbar",["$compile","$q","textAngularManager","taOptions","taTools",function(a,b,c,d,e){return{scope:{name:"@"},restrict:"EA",link:function(f,g,h){angular.extend(f,d),h.taToolbar&&(f.toolbar=f.$eval(h.taToolbar)),h.taToolbarClass&&(f.classes.toolbar=h.taToolbarClass),h.taToolbarGroupClass&&(f.classes.toolbarGroup=h.taToolbarGroupClass),h.taToolbarButtonClass&&(f.classes.toolbarButton=h.taToolbarButtonClass),h.taToolbarActiveButtonClass&&(f.classes.toolbarButtonActive=h.taToolbarActiveButtonClass),f.disabled=!0,f.focussed=!1,g.html(""),g.addClass("ta-toolbar "+f.classes.toolbar),f.$watch("focussed",function(){f.focussed?g.addClass(f.classes.focussed):g.removeClass(f.classes.focussed)}),setupToolElement=function(b,c,d){if(b.addClass(f.classes.toolbarButton),b.attr("name",d.name),b.attr("unselectable","on"),b.attr("ng-disabled","isDisabled()"),b.attr("tabindex","-1"),b.attr("ng-click","executeAction()"),b.on("mousedown",function(a){return a.preventDefault(),!1}),c&&(c.buttontext&&b.html(c.buttontext),c.iconclass)){var e=angular.element("<i>"),g=b.html();e.addClass(c.iconclass),b.html(""),b.append(e),b.append("&nbsp;"+g)}return d?a(b)(d):b},f.tools={},f._parent={disabled:!0,showHtml:!1};var i={$editor:function(){return f._parent},isDisabled:function(){return this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(a){return a?this.$editor().classes.toolbarButtonActive:""},executeAction:function(){var a=b.defer(),c=a.promise;c["finally"](this.$editor().endAction);var d=this.action(a,this.$editor().startAction());(d||void 0===d)&&a.resolve()}};angular.forEach(f.toolbar,function(a){groupElement=angular.element("<div>"),groupElement.addClass(f.classes.toolbarGroup),angular.forEach(a,function(a){toolElement=angular.element(e[a].display);var b=angular.extend(f.$new(!0),e[a],i,{name:a});f.tools[a]=b,groupElement.append(setupToolElement(toolElement,e[a],b)),f.tools[a].$element=toolElement}),g.append(groupElement)}),f.updateToolDisplay=function(a,b){var c=e[a],d=f.tools[a];d&&(null===b.buttontext?delete b.buttontext:!b.buttontext&&c.buttontext&&(b.buttontext=c.buttontext),null===b.iconclass?delete b.iconclass:!b.iconclass&&c.iconclass&&(b.iconclass=c.iconclass),toolElement=b.display&&""!==b.display?angular.element(b.display):null===b.display?angular.element(c.display):d.$element,toolElement=setupToolElement(toolElement,b,d),d.$element.replaceWith(toolElement),d.$element=toolElement)},c.registerToolbar(f)}}}]).service("textAngularManager",[function(){var a={},b={};return{registerEditor:function(c,d,e){if(!c||""===c)throw"textAngular Error: An editor requires a name";if(!d)throw"textAngular Error: An editor requires a scope";if(b[c])throw'textAngular Error: An Editor with name "'+c+'" already exists';var f=[];return angular.forEach(e,function(b){f[b]||f.push(a[b])}),b[c]={scope:d,toolbars:e,_registerToolbar:function(a){this.toolbars.indexOf(a.name)>=0&&f.push(a)}},{disable:function(){angular.forEach(f,function(a){a.disabled=!0})},enable:function(){angular.forEach(f,function(a){a.disabled=!1})},focus:function(){angular.forEach(f,function(a){a._parent=d,a.disabled=!1,a.focussed=!0})},unfocus:function(){angular.forEach(f,function(a){a.disabled=!0,a.focussed=!1})},updateSelectedStyles:function(a){angular.forEach(f,function(b){angular.forEach(b.tools,function(b){b.activeState&&(b.active=b.activeState(a))})})}}},registerToolbar:function(c){if(!c)throw"textAngular Error: A toolbar requires a scope";if(!c.name||""===c.name)throw"textAngular Error: A toolbar requires a name";if(a[c.name])throw'textAngular Error: A toolbar with name "'+c.name+'" already exists';a[c.name]=c,angular.forEach(b,function(a){a._registerToolbar(c)})},updateToolsDisplay:function(a){var b=this;angular.forEach(a,function(a,c){b.updateToolDisplay(c,a)})},resetToolsDisplay:function(){var a=this;angular.forEach(c,function(b,c){a.resetToolDisplay(c)})},updateToolDisplay:function(b,c){var d=this;angular.forEach(a,function(a,e){d.updateToolbarToolDisplay(e,b,c)})},resetToolDisplay:function(b){var c=this;angular.forEach(a,function(a,d){c.resetToolbarToolDisplay(d,b)})},updateToolbarToolDisplay:function(b,c,d){a[b]&&a[b].updateToolDisplay(c,d)},resetToolbarToolDisplay:function(b,d){a[b]&&a[b].updateToolDisplay(d,c[d])},refreshEditor:function(a){if(!b[a])throw'textAngular Error: No Editor with name "'+a+'" exists';b[a].scope.updateTaBindtaTextElement(),b[a].scope.$$phase||b[a].scope.$digest()}}}])}();