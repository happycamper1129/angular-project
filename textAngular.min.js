!function(){"Use Strict";function t(t,e){a[t]=e}var e=angular.module("textAngular",["ngSanitize"]);e.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"}});var a={};e.constant("taRegisterTool",t),e.value("taTools",a),e.config(function(t){t("html",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"Toggle HTML",action:function(){this.$editor().switchView(),this.active=this.$editor().showHtml}});for(var e=function(t){return function(){return this.$editor().queryFormatBlockState(t)}},a=1;6>=a;a++)t("h"+a,{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"H"+a,action:function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")},activeState:e("h"+a)});t("p",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),t("pre",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),t("ul",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}}),t("ol",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}}),t("quote",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),t("undo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}}),t("redo",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}}),t("bold",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")}}),t("justifyLeft",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(){return document.queryCommandState("justifyLeft")}}),t("justifyRight",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(){return document.queryCommandState("justifyRight")}}),t("justifyCenter",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(){return document.queryCommandState("justifyCenter")}}),t("italics",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")}}),t("underline",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")}}),t("clear",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-ban",action:function(){return this.$editor().wrapSelection("removeFormat",null)}}),t("insertImage",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-picture-o",action:function(){var t;return t=prompt("Please enter an image URL to insert","http://"),""!==t?this.$editor().wrapSelection("insertImage",t):void 0}}),t("insertLink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-link",action:function(){var t;return t=prompt("Please enter an URL to insert","http://"),""!==t?this.$editor().wrapSelection("createLink",t):void 0}}),t("unlink",{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>",iconclass:"fa fa-unlink",action:function(){return this.$editor().wrapSelection("unlink",null)}})}),e.directive("textAngular",["$compile","$timeout","$log","taOptions","taToolbarEditorLinker",function(t,e,a,n,o){return a.info("Thank you for using textAngular! http://www.textangular.com"),{require:"?ngModel",scope:{},restrict:"EA",link:function(a,l,i,s){var r,c,u,d,p,m=Math.floor(1e16*Math.random()),f=i.name?i.name:"textAngularEditor"+m;if(angular.extend(a,n,{wrapSelection:function(t,e){document.execCommand(t,!1,e),a.showHtml?a.displayElements.html[0].focus():a.displayElements.text[0].focus(),a.updateSelectedStyles(),a.showHtml||a.updateTaBindtext()},showHtml:!1}),i.taFocussedClass&&(a.classes.focussed=a.$eval(i.taFocussedClass)),i.taTextEditorClass&&(a.classes.textEditor=i.taTextEditorClass),i.taHtmlEditorClass&&(a.classes.htmlEditor=i.taHtmlEditorClass),d=l.html(),l.html(""),a.displayElements={forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")},l.append(a.displayElements.text),l.append(a.displayElements.html),i.name&&(a.displayElements.forminput.attr("name",i.name),l.append(a.displayElements.forminput)),i.taDisabled&&(a.displayElements.text.attr("ta-readonly","disabled"),a.displayElements.html.attr("ta-readonly","disabled"),a.disabled=a.$parent.$eval(i.taDisabled),a.$parent.$watch(i.taDisabled,function(t){a.disabled=t,a.disabled?l.addClass(a.classes.disabled):l.removeClass(a.classes.disabled)})),t(a.displayElements.text)(a),t(a.displayElements.html)(a),l.addClass("ta-root"),a.displayElements.text.addClass("ta-text ta-editor "+a.classes.textEditor),a.displayElements.html.addClass("ta-html ta-editor "+a.classes.textEditor),l.on("focusin",function(){l.addClass(a.classes.focussed),p.focus(),e(function(){l.triggerHandler("focus")},0)}),l.on("focusout",function(t){return e(function(){document.activeElement!==a.displayElements.html[0]&&document.activeElement!==a.displayElements.text[0]&&(l.removeClass(a.classes.focussed),p.unfocus(),e(function(){l.triggerHandler("blur")},0))},100),t.preventDefault(),!1}),a.queryFormatBlockState=function(t){t=t.toLowerCase();var e=document.queryCommandValue("formatBlock").toLowerCase();return e===t||e===t},a.switchView=function(){a.showHtml=!a.showHtml,a.showHtml?e(function(){return a.displayElements.html[0].focus()},100):e(function(){return a.displayElements.text[0].focus()},100)},i.ngModel?s.$render=function(){if(a.displayElements.forminput.val(s.$viewValue),document.activeElement!==a.displayElements.html[0]&&document.activeElement!==a.displayElements.text[0]){var t=s.$viewValue||"";a.text=t,a.html=t}}:(a.displayElements.forminput.val(d),a.text=d,a.html=d),a.$watch("text",function(t,e){a.html=t,i.ngModel&&t!==e&&s.$setViewValue(t),a.displayElements.forminput.val(t)}),a.$watch("html",function(t,e){a.text=t,i.ngModel&&t!==e&&s.$setViewValue(t),a.displayElements.forminput.val(t)}),i.taTargetToolbars)p=o.registerEditor(name,a,i.taTargetToolbars.split(","));else{var b=angular.element('<div text-angular-toolbar name="textAngularToolbar'+m+'">');l.prepend(b),t(b)(a.$parent),p=o.registerEditor(f,a,["textAngularToolbar"+m])}a.bUpdateSelectedStyles=!1,a.updateSelectedStyles=function(){p.updateSelectedStyles(),a.bUpdateSelectedStyles&&e(a.updateSelectedStyles,200)},r=function(){a.bUpdateSelectedStyles=!0,a.$apply(function(){a.updateSelectedStyles()})},a.displayElements.html.on("keydown",r),a.displayElements.text.on("keydown",r),c=function(){a.bUpdateSelectedStyles=!1},a.displayElements.html.on("keyup",c),a.displayElements.text.on("keyup",c),u=function(){a.$apply(function(){a.updateSelectedStyles()})},a.displayElements.html.on("mouseup",u),a.displayElements.text.on("mouseup",u)}}}]).directive("taBind",["$sanitize","taFixChrome",function(t,e){return{require:"ngModel",scope:{taBind:"@"},link:function(a,n,o,l){var i="textarea"!==n[0].tagName.toLowerCase()&&"input"!==n[0].tagName.toLowerCase()&&void 0!==n.attr("contenteditable")&&n.attr("contenteditable"),s=!1,r=function(){return e(n).html()};a.$parent["updateTaBind"+a.taBind]=function(){var t=r(),e=l.$parsers;l.$parsers=[],l.$oldViewValue=t,l.$setViewValue(t),l.$parsers=e},i&&n.on("keyup",function(){s||l.$setViewValue(r())}),l.$parsers.push(function(e){void 0===l.$oldViewValue&&(l.$oldViewValue=e);try{t(e)}catch(a){return l.$oldViewValue}return l.$oldViewValue=e,e}),l.$render=function(){if(document.activeElement!==n[0]){var t=l.$viewValue||"";if(l.$oldViewValue=t,"text"===a.taBind){var e=angular.element("<div>"+t+"</div>");e.find("script").remove(),n.html(e.html()),n.find("a").on("click",function(t){return t.preventDefault(),!1})}else i||"textarea"!==n[0].tagName.toLowerCase()&&"input"!==n[0].tagName.toLowerCase()?n.html(t):n.val(t)}else i||n.val(t)},o.taReadonly&&(a.$parent.$eval(o.taReadonly)?(("textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase())&&n.attr("disabled","disabled"),void 0!==n.attr("contenteditable")&&n.attr("contenteditable")&&n.removeAttr("contenteditable")):"textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase()?n.removeAttr("disabled"):i&&n.attr("contenteditable","true"),a.$parent.$watch(o.taReadonly,function(t,e){e!==t&&(t?(("textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase())&&n.attr("disabled","disabled"),void 0!==n.attr("contenteditable")&&n.attr("contenteditable")&&n.removeAttr("contenteditable")):"textarea"===n[0].tagName.toLowerCase()||"input"===n[0].tagName.toLowerCase()?n.removeAttr("disabled"):i&&n.attr("contenteditable","true"),s=t)}))}}}]).factory("taFixChrome",function(){var t=function(t){for(var e=angular.element(t).find("span"),a=0;a<e.length;a++){var n=angular.element(e[a]);n.attr("style")&&n.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n.next().length>0&&"BR"===n.next()[0].tagName&&n.next().remove(),n.replaceWith(n.html()))}var o=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return o!==t.html()&&t.html(o),t};return t}).directive("textAngularToolbar",["$compile","taToolbarEditorLinker","taOptions","taTools",function(t,e,a,n){return{scope:{name:"@"},restrict:"EA",link:function(o,l,i){angular.extend(o,a),i.taToolbar&&(o.toolbar=o.$eval(i.taToolbar)),i.taToolbarClass&&(o.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(o.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(o.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(o.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),o.disabled=!0,l.html(""),l.addClass("ta-toolbar "+o.classes.toolbar),o.tools={};for(var s=0;s<o.toolbar.length;s++){group=o.toolbar[s],groupElement=angular.element("<div>"),groupElement.addClass(o.classes.toolbarGroup);for(var r=0;r<group.length;r++){if(tool=group[r],toolElement=angular.element(n[tool].display),toolElement.addClass(o.classes.toolbarButton),toolElement.attr("unselectable","on"),toolElement.attr("ng-disabled","isDisabled()"),n[tool].buttontext&&toolElement.html(n[tool].buttontext),n[tool].iconclass){var c=angular.element("<i>");c.addClass(n[tool].iconclass),toolElement.append(c)}var u=angular.extend(o.$new(!0),n[tool],{$editor:function(){return o.$parent},name:tool,isDisabled:function(){return"function"==typeof this.disabled&&this.disabled()||"boolean"==typeof this.disabled&&this.disabled||"html"!==this.name&&(this.$parent.disabled||this.$parent.showHtml)||void 0===this.$parent.disabled||this.$parent.disabled},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});o.tools[tool]=u,groupElement.append(t(toolElement)(u)),o.tools[tool].$element=toolElement}l.append(groupElement)}o.updateTool=function(e,a){var l=n[e],i=o.tools[e];if(i){var s;a.display&&""!==a.display?(s=angular.element(a.display),s.addClass(o.classes.toolbarButton),s.attr("unselectable","on"),s.attr("ng-disabled","isDisabled()"),s=t(s)(i),i.$element.replaceWith(s),i.$element=s):s=i.$element,""!==a.buttontext&&a.buttontext||(delete a.buttontext,delete l.buttontext),a.buttontext&&""!==a.buttontext?s.html(a.buttontext):l.buttontext&&s.html(l.buttontext),""!==a.iconclass&&a.iconclass||(delete a.iconclass,delete l.iconclass);var r;if(a.iconclass?r=a.iconclass:l.iconclass&&(r=l.iconclass),s.find("i").remove(),r){var c=angular.element("<i>");c.addClass(r),s.append(c)}}},e.registerToolbar(o)}}}]).service("taToolbarEditorLinker",[function(){var t={},e={};return{registerEditor:function(a,n,o){var l=[];return angular.forEach(o,function(e){l[e]||l.push(t[e])}),e[a]={scope:n,toolbars:o,_registerToolbar:function(t){this.toolbars.indexOf(t.name)>=0&&l.push(t)}},{disable:function(){angular.forEach(l,function(t){t.disabled=!0})},enable:function(){angular.forEach(l,function(t){t.disabled=!1})},focus:function(){angular.forEach(l,function(t){t.$parent=n,t.disabled=!1})},unfocus:function(){return this.disable()},updateSelectedStyles:function(){angular.forEach(l,function(t){angular.forEach(t.tools,function(t){t.activeState&&(t.active=t.activeState(n))})})}}},registerToolbar:function(a){t[a.name]=a,angular.forEach(e,function(t){t._registerToolbar(a)})},updateTools:function(t){var e=this;angular.forEach(t,function(t,a){e.updateTool(a,t)})},resetTools:function(){var t=this;angular.forEach(a,function(e,a){t.resetTool(a)})},updateTool:function(e,a){var n=this;angular.forEach(t,function(t,o){n.updateToolbarTool(o,e,a)})},resetTool:function(e){var n=this;angular.forEach(t,function(t,o){n.resetToolbarTool(o,e,a[e])})},updateToolbarTool:function(e,a,n){t[e]&&t[e].updateTool(a,n)},resetToolbarTool:function(e,n){t[e]&&t[e].updateTool(n,a[n])}}}])}();